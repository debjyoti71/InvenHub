<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User and Store List</title>
    <style>
        body {
            background-color: #e3f2fd;
            color: #333;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 80%;
        }
        table, th, td {
            border: 1px solid #2196f3;
        }
        th, td {
            padding: 15px;
            text-align: left;
        }
        th {
            background-color: #bbdefb;
        }
        a {
            color: #1976d2;
            font-weight: bold;
        }
        a:hover {
            text-decoration: underline;
        }
        .delete-btn {
            color: red;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: bold;
        }
        .delete-btn:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h2>User and Store List</h2>

    <h3>Total Database Size: {{ db_size or "N/A" }}</h3>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul style="color: red; font-weight: bold; list-style: none;">
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <!-- User List -->
    <h3>User List</h3>
    {% if users %}
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                        <th>Phone</th>                   
                        <th>Stores</th>
                        <th>Actions</th>
                        <th>Make Admin</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                        <tr>
                            <td>{{ user.first_name }}</td>
                            <td>{{ user.last_name }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.phone }}</td>
                            <td>
                                {% if user.stores %}
                                    <ul>
                                        {% for store in user.stores %}
                                            <li>{{ store.store_name }}</li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    No stores
                                {% endif %}
                            </td>
                            <td>
                                <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" style="display:inline;">
                                    <button type="submit" class="delete-btn">Delete</button>
                                </form>
                            </td>
                            <td>
                                <form action="{{ url_for('make_user_role', user_id=user.id) }}" method="POST" style="display:inline;">
                                    {% if user.role_name.lower() == 'admin' %}
                                        <button type="submit" class="btn btn-primary" 
                                                onclick="return confirm('Are you sure you want to change this Admin to a User?')">Make User</button>
                                    {% else %}
                                        <button type="submit" class="btn btn-primary" 
                                                onclick="return confirm('Are you sure you want to promote this User to Admin?')">Make Admin</button>
                                    {% endif %}
                                </form>
                                <p>Current Role: <strong>{{ user.role_name }}</strong></p>
                            </td>                                                      
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="color: #666;">No users found.</p>
    {% endif %}

    <!-- Store List -->
    <h3>Store List</h3>
    {% if store_details %}
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Store Name</th>
                        <th>Store Location</th>
                        <th>Owner</th>
                        <th>Employees</th>
                        <th>Store Code</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for store in store_details %}
                        <tr>
                            <td>{{ store.name }}</td>
                            <td>{{ store.address }}</td>
                            <td>{{ store.owner | default("No Owner Assigned") }}</td>
                            <td>
                                {% if store.employees %}
                                    <ul>
                                        {% for employee in store.employees %}
                                            <li>{{ employee }}</li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    No Employees
                                {% endif %}
                            </td>
                            <td>{{ store.store_code }}</td>
                            <td>
                                <form action="{{ url_for('delete_store', store_id=store.id) }}" method="POST" style="display:inline;">
                                    <button type="submit" class="delete-btn">Delete Store</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>    
            </table>
        </div>
    {% else %}
        <p style="color: #666;">No stores found.</p>
    {% endif %}

    <br>
    <a href="{{ url_for('dashboard') }}">Back to Dashboard</a>
</body>
</html>
